{
  if (exam.getRoom() != null) {
    throw new IllegalStateException("Exam (" + exam + ") already has a room.");
  }
  Score unscheduledScore=scoreDirector.calculateScore();
  boolean perfectMatch=false;
  Score bestScore=DefaultHardSoftScore.valueOf(Integer.MIN_VALUE,Integer.MIN_VALUE);
  Room bestRoom=null;
  for (  Room room : roomList) {
    scoreDirector.beforeVariableChanged(exam,"room");
    exam.setRoom(room);
    scoreDirector.afterVariableChanged(exam,"room");
    Score score=scoreDirector.calculateScore();
    if (score.compareTo(unscheduledScore) < 0) {
      if (score.compareTo(bestScore) > 0) {
        bestScore=score;
        bestRoom=room;
      }
    }
 else     if (score.equals(unscheduledScore)) {
      perfectMatch=true;
      break;
    }
 else {
      throw new IllegalStateException("The score (" + score + ") cannot be higher than unscheduledScore ("+ unscheduledScore+ ").");
    }
  }
  if (!perfectMatch) {
    if (bestRoom == null) {
      throw new IllegalStateException("The bestRoom (" + bestRoom + ") cannot be null.");
    }
    scoreDirector.beforeVariableChanged(exam,"room");
    exam.setRoom(bestRoom);
    scoreDirector.afterVariableChanged(exam,"room");
  }
  logger.trace("    Exam ({}) initialized.",exam);
}
