{
  solverFactory.getSolverConfig().getTerminationConfig().setMaximumMinutesSpend(maximumMinutesSpend);
  SolverConfig solverConfig=solverFactory.getSolverConfig();
  solverConfig.setEnvironmentMode(environmentMode);
  ScoreDirectorFactoryConfig assertionScoreDirectorFactory=createOverwritingAssertionScoreDirectorFactory();
  if (assertionScoreDirectorFactory != null && environmentMode.isAsserted()) {
    solverConfig.getScoreDirectorFactoryConfig().setAssertionScoreDirectorFactory(assertionScoreDirectorFactory);
  }
  Solver solver=solverFactory.buildSolver();
  solver.setPlanningProblem(planningProblem);
  solver.solve();
  Solution bestSolution=solver.getBestSolution();
  if (bestSolution == null) {
    bestSolution=planningProblem;
  }
  return bestSolution;
}
