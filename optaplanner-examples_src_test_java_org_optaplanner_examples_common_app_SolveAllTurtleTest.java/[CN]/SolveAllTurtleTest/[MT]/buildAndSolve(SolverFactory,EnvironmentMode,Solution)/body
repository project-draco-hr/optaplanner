{
  SolverConfig solverConfig=solverFactory.getSolverConfig();
  solverConfig.setEnvironmentMode(environmentMode);
  ScoreDirectorFactoryConfig assertionScoreDirectorFactory=createOverwritingAssertionScoreDirectorFactory();
  if (assertionScoreDirectorFactory != null && environmentMode.isAsserted()) {
    solverConfig.getScoreDirectorFactoryConfig().setAssertionScoreDirectorFactory(assertionScoreDirectorFactory);
  }
  Solver solver=solverFactory.buildSolver();
  solver.setPlanningProblem(solution);
  solver.solve();
  return solver.getBestSolution();
}
