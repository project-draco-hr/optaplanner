{
  translator=new LatitudeLongitudeTranslator();
  for (  City city : travelingSalesmanTour.getCityList()) {
    translator.addCoordinates(city.getLatitude(),city.getLongitude());
  }
  Dimension size=getSize();
  double width=size.getWidth();
  double height=size.getHeight();
  translator.prepareFor(width,height);
  Graphics g=createCanvas(width,height);
  String tourName=travelingSalesmanTour.getName();
  if (tourName.startsWith("europe")) {
    g.drawImage(europaBackground.getImage(),0,0,translator.getImageWidth(),translator.getImageHeight(),this);
  }
  g.setFont(g.getFont().deriveFont((float)CITY_NAME_TEXT_SIZE));
  g.setColor(TangoColorFactory.PLUM_2);
  for (  Visit visit : travelingSalesmanTour.getVisitList()) {
    City city=visit.getCity();
    int x=translator.translateLongitudeToX(city.getLongitude());
    int y=translator.translateLatitudeToY(city.getLatitude());
    g.fillRect(x - 1,y - 1,3,3);
    if (city.getName() != null) {
      g.drawString(city.getName(),x + 3,y - 3);
    }
  }
  g.setColor(TangoColorFactory.ALUMINIUM_4);
  Domicile domicile=travelingSalesmanTour.getDomicile();
  City domicileCity=domicile.getCity();
  int domicileX=translator.translateLongitudeToX(domicileCity.getLongitude());
  int domicileY=translator.translateLatitudeToY(domicileCity.getLatitude());
  g.fillRect(domicileX - 2,domicileY - 2,5,5);
  if (domicileCity.getName() != null) {
    g.drawString(domicileCity.getName(),domicileX + 3,domicileY - 3);
  }
  Set<Visit> needsBackToDomicileLineSet=new HashSet<Visit>(travelingSalesmanTour.getVisitList());
  for (  Visit trailingVisit : travelingSalesmanTour.getVisitList()) {
    if (trailingVisit.getPreviousStandstill() instanceof Visit) {
      needsBackToDomicileLineSet.remove(trailingVisit.getPreviousStandstill());
    }
  }
  g.setColor(TangoColorFactory.CHOCOLATE_1);
  for (  Visit visit : travelingSalesmanTour.getVisitList()) {
    if (visit.getPreviousStandstill() != null) {
      City previousCity=visit.getPreviousStandstill().getCity();
      int previousX=translator.translateLongitudeToX(previousCity.getLongitude());
      int previousY=translator.translateLatitudeToY(previousCity.getLatitude());
      City city=visit.getCity();
      int x=translator.translateLongitudeToX(city.getLongitude());
      int y=translator.translateLatitudeToY(city.getLatitude());
      g.drawLine(previousX,previousY,x,y);
      if (needsBackToDomicileLineSet.contains(visit)) {
        g.drawLine(x,y,domicileX,domicileY);
      }
    }
  }
  g.setColor(TangoColorFactory.ALUMINIUM_4);
  g.fillRect(5,(int)height - 15 - TEXT_SIZE,5,5);
  g.drawString("Domicile",15,(int)height - 10 - TEXT_SIZE);
  g.setColor(TangoColorFactory.PLUM_2);
  g.fillRect(6,(int)height - 9,3,3);
  g.drawString("Visit",15,(int)height - 5);
  g.setColor(TangoColorFactory.ALUMINIUM_5);
  String citiesSizeString=travelingSalesmanTour.getCityList().size() + " cities";
  g.drawString(citiesSizeString,((int)width - g.getFontMetrics().stringWidth(citiesSizeString)) / 2,(int)height - 5);
  String clickString="Click anywhere in the map to add a visit.";
  g.drawString(clickString,(int)width - 5 - g.getFontMetrics().stringWidth(clickString),(int)height - 5);
  g.setColor(TangoColorFactory.ORANGE_3);
  SimpleLongScore score=travelingSalesmanTour.getScore();
  if (score != null) {
    double fuel=((double)-score.getScore()) / 1000.0;
    String fuelString=NUMBER_FORMAT.format(fuel) + " fuel";
    g.setFont(g.getFont().deriveFont(Font.BOLD,(float)TEXT_SIZE * 2));
    g.drawString(fuelString,(int)width - g.getFontMetrics().stringWidth(fuelString) - 10,(int)height - 10 - TEXT_SIZE);
  }
  repaint();
}
