{
  GreedySolverPhaseScope greedySolverPhaseScope=greedyStepScope.getGreedySolverPhaseScope();
  Score lastStepScore=greedySolverPhaseScope.calculateScoreFromWorkingMemory();
  BruteForcePlanningEntityIterator bruteForcePlanningEntityIterator=new BruteForcePlanningEntityIterator(greedySolverPhaseScope,greedyStepScope.getPlanningEntity());
  Score maxScore=greedySolverPhaseScope.getScoreDefinition().getPerfectMinimumScore();
  while (bruteForcePlanningEntityIterator.hasNext()) {
    bruteForcePlanningEntityIterator.next();
    Score score=greedySolverPhaseScope.calculateScoreFromWorkingMemory();
    if (assertMoveScoreIsUncorrupted) {
      greedySolverPhaseScope.assertWorkingScore(score);
    }
    if (score.compareTo(maxScore) > 0) {
      greedyStepScope.setVariableToValueMap(bruteForcePlanningEntityIterator.getVariableToValueMap());
      maxScore=score;
    }
    if (pickEarlyFitType == PickEarlyFitType.FIRST_LAST_STEP_SCORE_IMPROVING_OR_EQUAL && score.compareTo(lastStepScore) >= 0) {
      break;
    }
  }
  greedyStepScope.setScore(maxScore);
}
