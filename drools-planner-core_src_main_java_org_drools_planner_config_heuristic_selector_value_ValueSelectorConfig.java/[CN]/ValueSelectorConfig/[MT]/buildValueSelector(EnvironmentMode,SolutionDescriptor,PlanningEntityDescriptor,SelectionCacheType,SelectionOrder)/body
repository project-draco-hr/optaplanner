{
  PlanningVariableDescriptor variableDescriptor=fetchVariableDescriptor(entityDescriptor);
  SelectionCacheType resolvedCacheType=SelectionCacheType.resolve(cacheType,minimumCacheType);
  minimumCacheType=SelectionCacheType.max(minimumCacheType,resolvedCacheType);
  SelectionOrder resolvedSelectionOrder=SelectionOrder.resolve(selectionOrder,inheritedSelectionOrder);
  ValueSelector valueSelector=buildBaseValueSelector(environmentMode,variableDescriptor,minimumCacheType,resolvedCacheType.isCached() ? SelectionOrder.ORIGINAL : resolvedSelectionOrder);
  valueSelector=applyProbability(resolvedCacheType,resolvedSelectionOrder,valueSelector);
  valueSelector=applyShuffling(resolvedCacheType,resolvedSelectionOrder,valueSelector);
  valueSelector=applyCaching(resolvedCacheType,resolvedSelectionOrder,valueSelector);
  return valueSelector;
}
