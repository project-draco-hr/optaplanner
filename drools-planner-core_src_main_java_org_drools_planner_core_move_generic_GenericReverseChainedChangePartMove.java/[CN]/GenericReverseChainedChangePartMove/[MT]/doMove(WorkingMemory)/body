{
  Object oldFirstPlanningValue=planningVariableDescriptor.getValue(firstEntity);
  if (firstEntity.equals(newTrailingEntity)) {
    if (oldTrailingEntity != null) {
      planningVariableDescriptor.setValue(oldTrailingEntity,oldFirstPlanningValue);
      workingMemory.update(oldTrailingEntityFactHandle,oldTrailingEntity);
    }
  }
 else {
    if (oldTrailingEntity != null) {
      planningVariableDescriptor.setValue(oldTrailingEntity,oldFirstPlanningValue);
      workingMemory.update(oldTrailingEntityFactHandle,oldTrailingEntity);
    }
  }
  Object nextEntity=toPlanningValue;
  for (ListIterator<Object> it=entitiesSubChain.listIterator(entitiesSubChain.size()); it.hasPrevious(); ) {
    Object entity=it.previous();
    planningVariableDescriptor.setValue(entity,nextEntity);
    workingMemory.update(workingMemory.getFactHandle(entity),entity);
    nextEntity=entity;
  }
  if (firstEntity.equals(newTrailingEntity)) {
    if (oldTrailingEntity != null) {
      planningVariableDescriptor.setValue(oldTrailingEntity,firstEntity);
      workingMemory.update(oldTrailingEntityFactHandle,oldTrailingEntity);
    }
  }
 else {
    if (newTrailingEntity != null) {
      planningVariableDescriptor.setValue(newTrailingEntity,firstEntity);
      workingMemory.update(newTrailingEntityFactHandle,newTrailingEntity);
    }
  }
}
