{
  final City newCity=new City();
  Long cityId=0L;
  for (  City city : getTravelingSalesmanTour().getCityList()) {
    if (cityId <= city.getId()) {
      cityId=city.getId() + 1L;
    }
  }
  newCity.setId(cityId);
  newCity.setLongitude(longitude);
  newCity.setLatitude(latitude);
  logger.info("Scheduling insertion of newCity ({}).",newCity);
  solutionBusiness.doProblemFactChange(new ProblemFactChange(){
    public void doChange(    SolutionDirector solutionDirector){
      TravelingSalesmanTour solution=(TravelingSalesmanTour)solutionDirector.getWorkingSolution();
      WorkingMemory workingMemory=solutionDirector.getWorkingMemory();
      solution.getCityList().add(newCity);
      workingMemory.insert(newCity);
      Visit newVisit=new Visit();
      newVisit.setId(newCity.getId());
      newVisit.setCity(newCity);
      solution.getVisitList().add(newVisit);
    }
  }
);
  updatePanel(solutionBusiness.getSolution());
}
