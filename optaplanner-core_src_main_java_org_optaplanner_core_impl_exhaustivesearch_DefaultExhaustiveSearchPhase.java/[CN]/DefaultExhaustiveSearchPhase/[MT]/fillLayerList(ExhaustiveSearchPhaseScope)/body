{
  ExhaustiveSearchStepScope stepScope=new ExhaustiveSearchStepScope(phaseScope);
  entitySelector.stepStarted(stepScope);
  long entitySize=entitySelector.getSize();
  if (entitySize > (long)Integer.MAX_VALUE) {
    throw new IllegalStateException("The entitySelector (" + entitySelector + ") has an entitySize ("+ entitySize+ ") which is higher than Integer.MAX_VALUE.");
  }
  List<ExhaustiveSearchLayer> layerList=new ArrayList<ExhaustiveSearchLayer>((int)entitySize);
  int depth=0;
  int uninitializedVariableCount=phaseScope.getSolutionDescriptor().countUninitializedVariables(phaseScope.getWorkingSolution());
  Collection<GenuineVariableDescriptor> genuineVariableDescriptors=entitySelector.getEntityDescriptor().getGenuineVariableDescriptors();
  for (  Object entity : entitySelector) {
    ExhaustiveSearchLayer layer=new ExhaustiveSearchLayer(depth,entity,uninitializedVariableCount);
    layerList.add(layer);
    depth++;
    for (    GenuineVariableDescriptor genuineVariableDescriptor : genuineVariableDescriptors) {
      if (!genuineVariableDescriptor.isInitialized(entity)) {
        uninitializedVariableCount--;
      }
    }
  }
  ExhaustiveSearchLayer layer=new ExhaustiveSearchLayer(depth,null,uninitializedVariableCount);
  layerList.add(layer);
  entitySelector.stepEnded(stepScope);
  phaseScope.setLayerList(layerList);
}
