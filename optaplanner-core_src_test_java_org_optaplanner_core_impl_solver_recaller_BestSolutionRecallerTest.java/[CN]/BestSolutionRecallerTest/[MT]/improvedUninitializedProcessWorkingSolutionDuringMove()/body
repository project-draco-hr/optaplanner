{
  BestSolutionRecaller recaller=new BestSolutionRecaller();
  recaller.setSolverEventSupport(mock(SolverEventSupport.class));
  DefaultSolverScope solverScope=new DefaultSolverScope();
  ConstructionHeuristicPhaseScope phaseScope=mock(ConstructionHeuristicPhaseScope.class);
  when(phaseScope.getSolverScope()).thenReturn(solverScope);
  ConstructionHeuristicStepScope stepScope=mock(ConstructionHeuristicStepScope.class);
  when(stepScope.getPhaseScope()).thenReturn(phaseScope);
  InnerScoreDirector sd=mock(InnerScoreDirector.class);
  solverScope.setScoreDirector(sd);
  Solution helpSolution=mock(Solution.class);
  when(helpSolution.getScore()).thenReturn(SimpleScore.parseScore("-2"));
  when(sd.cloneWorkingSolution()).thenReturn(helpSolution);
  solverScope.setBestUninitializedVariableCount(1);
  Score score=SimpleScore.parseScore("-1");
  recaller.processWorkingSolutionDuringMove(0,score,stepScope);
  assertEquals(helpSolution,solverScope.getBestSolution());
  assertEquals(-2,((SimpleScore)solverScope.getBestScore()).getScore());
  assertEquals(0,solverScope.getBestUninitializedVariableCount());
}
