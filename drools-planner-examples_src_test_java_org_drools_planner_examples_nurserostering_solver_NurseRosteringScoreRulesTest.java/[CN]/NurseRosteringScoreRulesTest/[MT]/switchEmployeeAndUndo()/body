{
  DefaultSolverScope solverScope=new DefaultSolverScope();
  LocalSearchSolverPhaseScope localSearchSolverPhaseScope=new LocalSearchSolverPhaseScope(solverScope);
  solverScope.setRuleBase(buildRuleBase());
  solverScope.setWorkingScoreCalculator(new DefaultHardAndSoftConstraintScoreCalculator());
  NurseRoster nurseRoster=(NurseRoster)new NurseRosteringDaoImpl().readSolution(getClass().getResourceAsStream("/org/drools/planner/examples/nurserostering/data/testNurseRosteringScoreRules.xml"));
  solverScope.setWorkingSolution(nurseRoster);
  WorkingMemory workingMemory=localSearchSolverPhaseScope.getWorkingMemory();
  Score firstScore=localSearchSolverPhaseScope.calculateScoreFromWorkingMemory();
  Employee leftEmployee=findEmployeeById(nurseRoster,0L);
  Assignment leftAssignment=findAssignmentById(nurseRoster,200204001L);
  assertEquals(leftEmployee,leftAssignment.getEmployee());
  Employee rightEmployee=findEmployeeById(nurseRoster,12L);
  Assignment rightAssignment=findAssignmentById(nurseRoster,200204002L);
  assertEquals(rightEmployee,rightAssignment.getEmployee());
  NurseRosteringMoveHelper.moveEmployee(workingMemory,leftAssignment,rightEmployee);
  NurseRosteringMoveHelper.moveEmployee(workingMemory,rightAssignment,leftEmployee);
  localSearchSolverPhaseScope.calculateScoreFromWorkingMemory();
  NurseRosteringMoveHelper.moveEmployee(workingMemory,rightAssignment,rightEmployee);
  NurseRosteringMoveHelper.moveEmployee(workingMemory,leftAssignment,leftEmployee);
  Score secondScore=localSearchSolverPhaseScope.calculateScoreFromWorkingMemory();
  assertEquals(firstScore,secondScore);
}
