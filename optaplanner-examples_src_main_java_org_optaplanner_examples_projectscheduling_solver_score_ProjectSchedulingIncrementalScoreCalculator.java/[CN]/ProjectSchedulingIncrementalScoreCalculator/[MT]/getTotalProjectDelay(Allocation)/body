{
  Project p=allocation.getJob().getProject();
  int previousProjectDelay=projectDelayMap.containsKey(p) ? projectDelayMap.get(p) : 0;
  totalProjectDelay-=previousProjectDelay;
  Allocation sink=allocation.getSinkAllocation();
  Integer endDate=sink.getEndDate();
  if (endDate == null) {
    projectDelayMap.put(p,0);
  }
 else {
    int delay=endDate - p.getReleaseDate() - p.getCriticalPathDuration();
    totalProjectDelay+=delay;
    projectDelayMap.put(p,delay);
  }
  return totalProjectDelay;
}
