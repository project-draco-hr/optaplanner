{
  WorkingMemory workingMemory=abstractSolverScope.getWorkingMemory();
  List<SeatDesignation> seatDesignationList=createSeatDesignationList(manners2009);
  List<Seat> undesignatedSeatList=manners2009.getSeatList();
  for (  SeatDesignation seatDesignation : seatDesignationList) {
    Score bestScore=DefaultSimpleScore.valueOf(Integer.MIN_VALUE);
    Seat bestSeat=null;
    FactHandle seatDesignationHandle=null;
    for (    Seat seat : undesignatedSeatList) {
      if (seatDesignation.getGuest().getGender() == seat.getRequiredGender()) {
        if (seatDesignationHandle == null) {
          seatDesignation.setSeat(seat);
          seatDesignationHandle=workingMemory.insert(seatDesignation);
        }
 else {
          seatDesignation.setSeat(seat);
          workingMemory.update(seatDesignationHandle,seatDesignation);
        }
        Score score=abstractSolverScope.calculateScoreFromWorkingMemory();
        if (score.compareTo(bestScore) > 0) {
          bestScore=score;
          bestSeat=seat;
        }
      }
    }
    if (bestSeat == null) {
      throw new IllegalStateException("The bestSeat (" + bestSeat + ") cannot be null.");
    }
    seatDesignation.setSeat(bestSeat);
    workingMemory.update(seatDesignationHandle,seatDesignation);
    undesignatedSeatList.remove(bestSeat);
  }
  Collections.sort(seatDesignationList,new PersistableIdComparator());
  manners2009.setSeatDesignationList(seatDesignationList);
}
