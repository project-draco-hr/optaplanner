{
  Object oldFirstPlanningValue=variableDescriptor.getValue(firstEntity);
  Object oldTrailingEntity=scoreDirector.getTrailingEntity(variableDescriptor,lastEntity);
  Object newTrailingEntity=scoreDirector.getTrailingEntity(variableDescriptor,toPlanningValue);
  if (firstEntity.equals(newTrailingEntity)) {
    if (oldTrailingEntity != null) {
      scoreDirector.beforeVariableChanged(oldTrailingEntity,variableDescriptor.getVariableName());
      variableDescriptor.setValue(oldTrailingEntity,oldFirstPlanningValue);
      scoreDirector.afterVariableChanged(oldTrailingEntity,variableDescriptor.getVariableName());
    }
  }
 else {
    if (oldTrailingEntity != null) {
      scoreDirector.beforeVariableChanged(oldTrailingEntity,variableDescriptor.getVariableName());
      variableDescriptor.setValue(oldTrailingEntity,oldFirstPlanningValue);
      scoreDirector.afterVariableChanged(oldTrailingEntity,variableDescriptor.getVariableName());
    }
  }
  Object nextEntity=toPlanningValue;
  List<Object> entityList=subChain.getEntityList();
  for (ListIterator<Object> it=entityList.listIterator(entityList.size()); it.hasPrevious(); ) {
    Object entity=it.previous();
    scoreDirector.beforeVariableChanged(entity,variableDescriptor.getVariableName());
    variableDescriptor.setValue(entity,nextEntity);
    scoreDirector.afterVariableChanged(entity,variableDescriptor.getVariableName());
    nextEntity=entity;
  }
  if (firstEntity.equals(newTrailingEntity)) {
    if (oldTrailingEntity != null) {
      scoreDirector.beforeVariableChanged(oldTrailingEntity,variableDescriptor.getVariableName());
      variableDescriptor.setValue(oldTrailingEntity,firstEntity);
      scoreDirector.afterVariableChanged(oldTrailingEntity,variableDescriptor.getVariableName());
    }
  }
 else {
    if (newTrailingEntity != null) {
      scoreDirector.beforeVariableChanged(newTrailingEntity,variableDescriptor.getVariableName());
      variableDescriptor.setValue(newTrailingEntity,firstEntity);
      scoreDirector.afterVariableChanged(newTrailingEntity,variableDescriptor.getVariableName());
    }
  }
}
