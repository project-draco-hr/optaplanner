{
  List<Move> moveList=new ArrayList<Move>();
  List<Object> entityList=solutionDescriptor.getPlanningEntityList(solution);
  for (ListIterator<Object> leftIt=entityList.listIterator(); leftIt.hasNext(); ) {
    Object leftEntity=leftIt.next();
    PlanningEntityDescriptor leftEntityDescriptor=solutionDescriptor.getPlanningEntityDescriptor(leftEntity.getClass());
    Collection<PlanningVariableDescriptor> variableDescriptors=leftEntityDescriptor.getPlanningVariableDescriptors();
    for (    PlanningVariableDescriptor variableDescriptor : variableDescriptors) {
      if (variableDescriptor.isChained()) {
        throw new IllegalStateException("The planningEntityClass (" + variableDescriptor.getPlanningEntityDescriptor().getPlanningEntityClass() + ")'s planningVariableDescriptor ("+ variableDescriptor.getVariablePropertyName()+ ") is chained and can therefor not use the moveFactory ("+ this.getClass()+ ").");
      }
    }
    for (ListIterator<Object> rightIt=entityList.listIterator(leftIt.nextIndex()); rightIt.hasNext(); ) {
      Object rightEntity=rightIt.next();
      PlanningEntityDescriptor rightEntityDescriptor=solutionDescriptor.getPlanningEntityDescriptor(leftEntity.getClass());
      if (leftEntityDescriptor.getPlanningEntityClass().equals(rightEntityDescriptor.getPlanningEntityClass())) {
        moveList.add(new GenericSwapMove(variableDescriptors,leftEntity,rightEntity));
      }
    }
  }
  return moveList;
}
