{
  InnerScoreDirector innerScoreDirector=(InnerScoreDirector)scoreDirector;
  Object oldValue=variableDescriptor.getValue(entity);
  Object oldTrailingEntity=innerScoreDirector.getTrailingEntity(variableDescriptor,entity);
  Object newTrailingEntity=toPlanningValue == null ? null : innerScoreDirector.getTrailingEntity(variableDescriptor,toPlanningValue);
  if (oldTrailingEntity != null) {
    scoreDirector.beforeVariableChanged(oldTrailingEntity,variableDescriptor.getVariableName());
  }
  scoreDirector.beforeVariableChanged(entity,variableDescriptor.getVariableName());
  if (newTrailingEntity != null) {
    scoreDirector.beforeVariableChanged(newTrailingEntity,variableDescriptor.getVariableName());
  }
  if (oldTrailingEntity != null) {
    variableDescriptor.setValue(oldTrailingEntity,oldValue);
  }
  variableDescriptor.setValue(entity,toPlanningValue);
  if (newTrailingEntity != null) {
    variableDescriptor.setValue(newTrailingEntity,entity);
  }
  if (oldTrailingEntity != null) {
    scoreDirector.afterVariableChanged(oldTrailingEntity,variableDescriptor.getVariableName());
  }
  scoreDirector.afterVariableChanged(entity,variableDescriptor.getVariableName());
  if (newTrailingEntity != null) {
    scoreDirector.afterVariableChanged(newTrailingEntity,variableDescriptor.getVariableName());
  }
}
