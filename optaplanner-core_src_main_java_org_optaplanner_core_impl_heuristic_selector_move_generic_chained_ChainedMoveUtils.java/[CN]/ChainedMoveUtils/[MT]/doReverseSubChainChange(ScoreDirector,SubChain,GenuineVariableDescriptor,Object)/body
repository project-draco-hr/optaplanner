{
  InnerScoreDirector innerScoreDirector=(InnerScoreDirector)scoreDirector;
  Object firstEntity=subChain.getFirstEntity();
  Object lastEntity=subChain.getLastEntity();
  Object oldFirstValue=variableDescriptor.getValue(firstEntity);
  Object oldTrailingEntity=innerScoreDirector.getTrailingEntity(variableDescriptor,lastEntity);
  Object newTrailingEntity=innerScoreDirector.getTrailingEntity(variableDescriptor,toPlanningValue);
  boolean unmovedReverse=firstEntity == newTrailingEntity;
  List<Object> entityList=subChain.getEntityList();
  if (oldTrailingEntity != null) {
    scoreDirector.beforeVariableChanged(variableDescriptor,oldTrailingEntity);
  }
  for (ListIterator<Object> it=entityList.listIterator(entityList.size()); it.hasPrevious(); ) {
    Object entity=it.previous();
    scoreDirector.beforeVariableChanged(variableDescriptor,entity);
  }
  if (!unmovedReverse) {
    if (newTrailingEntity != null) {
      scoreDirector.beforeVariableChanged(variableDescriptor,newTrailingEntity);
    }
  }
  if (oldTrailingEntity != null) {
    variableDescriptor.setValue(oldTrailingEntity,oldFirstValue);
  }
  Object nextEntity=toPlanningValue;
  for (ListIterator<Object> it=entityList.listIterator(entityList.size()); it.hasPrevious(); ) {
    Object entity=it.previous();
    variableDescriptor.setValue(entity,nextEntity);
    nextEntity=entity;
  }
  if (unmovedReverse) {
    if (oldTrailingEntity != null) {
      variableDescriptor.setValue(oldTrailingEntity,firstEntity);
    }
  }
 else {
    if (newTrailingEntity != null) {
      variableDescriptor.setValue(newTrailingEntity,firstEntity);
    }
  }
  if (oldTrailingEntity != null) {
    scoreDirector.afterVariableChanged(variableDescriptor,oldTrailingEntity);
  }
  for (ListIterator<Object> it=entityList.listIterator(entityList.size()); it.hasPrevious(); ) {
    Object entity=it.previous();
    scoreDirector.afterVariableChanged(variableDescriptor,entity);
  }
  if (!unmovedReverse) {
    if (newTrailingEntity != null) {
      scoreDirector.afterVariableChanged(variableDescriptor,newTrailingEntity);
    }
  }
}
