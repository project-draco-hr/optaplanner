{
  AgendaItem agendaItem=prepareAgendaItemForUnMatchListener(kcontext);
  if (!constraintMatchEnabled) {
    agendaItem.setActivationUnMatchListener(new ActivationUnMatchListener(){
      public void unMatch(      RuleRuntime wm,      Match activation){
        undoListener.run();
      }
    }
);
  }
 else {
    final DoubleConstraintMatchTotal constraintMatchTotal=findDoubleConstraintMatchTotal(kcontext,scoreLevel);
    final DoubleConstraintMatch constraintMatch=constraintMatchTotal.addConstraintMatch(kcontext,weight);
    agendaItem.setActivationUnMatchListener(new ActivationUnMatchListener(){
      public void unMatch(      RuleRuntime wm,      Match activation){
        undoListener.run();
        constraintMatchTotal.removeConstraintMatch(constraintMatch);
      }
    }
);
  }
}
