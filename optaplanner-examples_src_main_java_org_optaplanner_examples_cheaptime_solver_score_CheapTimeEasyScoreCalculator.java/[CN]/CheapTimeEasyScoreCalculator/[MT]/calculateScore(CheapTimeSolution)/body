{
  if (solution.getGlobalPeriodRangeFrom() != 0) {
    throw new IllegalStateException("The globalPeriodRangeFrom (" + solution.getGlobalPeriodRangeFrom() + ") should be 0.");
  }
  int resourceListSize=solution.getResourceList().size();
  int globalPeriodRangeTo=solution.getGlobalPeriodRangeTo();
  List<Machine> machineList=solution.getMachineList();
  Map<Machine,List<MachinePeriodPart>> machinePeriodListMap=new LinkedHashMap<Machine,List<MachinePeriodPart>>(machineList.size());
  for (  Machine machine : machineList) {
    List<MachinePeriodPart> machinePeriodList=new ArrayList<MachinePeriodPart>(globalPeriodRangeTo);
    for (int period=0; period < globalPeriodRangeTo; period++) {
      machinePeriodList.add(new MachinePeriodPart(machine,period,resourceListSize));
    }
    machinePeriodListMap.put(machine,machinePeriodList);
  }
  for (  TaskAssignment taskAssignment : solution.getTaskAssignmentList()) {
    Machine machine=taskAssignment.getMachine();
    Integer startPeriod=taskAssignment.getStartPeriod();
    if (machine != null && startPeriod != null) {
      List<MachinePeriodPart> machinePeriodList=machinePeriodListMap.get(machine);
      int endPeriod=taskAssignment.getEndPeriod();
      for (int period=startPeriod; period < endPeriod; period++) {
        MachinePeriodPart machinePeriodPart=machinePeriodList.get(period);
        machinePeriodPart.addTaskAssignment(taskAssignment);
      }
    }
  }
  long hardScore=0L;
  long softScore=0L;
  List<PeriodPowerCost> periodPowerCostList=solution.getPeriodPowerCostList();
  for (int period=0; period < globalPeriodRangeTo; period++) {
    long powerConsumptionTotalMicros=0L;
    PeriodPowerCost periodPowerCost=periodPowerCostList.get(period);
    for (    Map.Entry<Machine,List<MachinePeriodPart>> entry : machinePeriodListMap.entrySet()) {
      Machine machine=entry.getKey();
      MachinePeriodPart machinePeriodPart=entry.getValue().get(period);
      if (machinePeriodPart.isActive()) {
        powerConsumptionTotalMicros+=machine.getPowerConsumptionMicros();
        powerConsumptionTotalMicros+=machinePeriodPart.getTaskPowerConsumptionTotalMicros();
        hardScore+=machinePeriodPart.getHardScore();
      }
    }
    softScore-=CostCalculator.multiplyTwoMicros(powerConsumptionTotalMicros,periodPowerCost.getPowerCostMicros());
  }
  return HardSoftLongScore.valueOf(hardScore,softScore);
}
