{
  DefaultSolver solver=new DefaultSolver();
  BasicPlumbingTermination basicPlumbingTermination=new BasicPlumbingTermination();
  solver.setBasicPlumbingTermination(basicPlumbingTermination);
  EnvironmentMode environmentMode=this.environmentMode == null ? EnvironmentMode.REPRODUCIBLE : this.environmentMode;
  if (randomSeed != null) {
    solver.setRandomSeed(randomSeed);
  }
 else {
    if (environmentMode != EnvironmentMode.PRODUCTION) {
      solver.setRandomSeed(DEFAULT_RANDOM_SEED);
    }
  }
  SolutionDescriptor solutionDescriptor=buildSolutionDescriptor();
  ScoreDirectorFactoryConfig scoreDirectorFactoryConfig_=scoreDirectorFactoryConfig == null ? new ScoreDirectorFactoryConfig() : scoreDirectorFactoryConfig;
  ScoreDirectorFactory scoreDirectorFactory=scoreDirectorFactoryConfig_.buildScoreDirectorFactory(environmentMode,solutionDescriptor);
  solver.setScoreDirectorFactory(scoreDirectorFactory);
  ScoreDefinition scoreDefinition=scoreDirectorFactory.getScoreDefinition();
  HeuristicConfigPolicy configPolicy=new HeuristicConfigPolicy(environmentMode,solutionDescriptor,scoreDefinition);
  TerminationConfig terminationConfig_=terminationConfig == null ? new TerminationConfig() : terminationConfig;
  Termination termination=terminationConfig_.buildTermination(configPolicy,basicPlumbingTermination);
  solver.setTermination(termination);
  BestSolutionRecaller bestSolutionRecaller=buildBestSolutionRecaller(environmentMode);
  solver.setBestSolutionRecaller(bestSolutionRecaller);
  if (CollectionUtils.isEmpty(solverPhaseConfigList)) {
    throw new IllegalArgumentException("Configure at least 1 phase (for example <localSearch>) in the solver configuration.");
  }
  List<SolverPhase> solverPhaseList=new ArrayList<SolverPhase>(solverPhaseConfigList.size());
  int phaseIndex=0;
  for (  SolverPhaseConfig solverPhaseConfig : solverPhaseConfigList) {
    SolverPhase solverPhase=solverPhaseConfig.buildSolverPhase(phaseIndex,configPolicy,termination);
    ((AbstractSolverPhase)solverPhase).setBestSolutionRecaller(bestSolutionRecaller);
    solverPhaseList.add(solverPhase);
    phaseIndex++;
  }
  solver.setSolverPhaseList(solverPhaseList);
  return solver;
}
