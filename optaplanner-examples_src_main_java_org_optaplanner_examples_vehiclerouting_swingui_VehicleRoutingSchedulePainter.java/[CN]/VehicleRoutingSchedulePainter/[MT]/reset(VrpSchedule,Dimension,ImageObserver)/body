{
  translator=new LatitudeLongitudeTranslator();
  for (  VrpLocation location : schedule.getLocationList()) {
    translator.addCoordinates(location.getLatitude(),location.getLongitude());
  }
  double width=size.getWidth();
  double height=size.getHeight();
  translator.prepareFor(width,height);
  Graphics g=createCanvas(width,height);
  g.setFont(g.getFont().deriveFont((float)TEXT_SIZE));
  for (  VrpCustomer customer : schedule.getCustomerList()) {
    VrpLocation location=customer.getLocation();
    int x=translator.translateLongitudeToX(location.getLongitude());
    int y=translator.translateLatitudeToY(location.getLatitude());
    g.setColor(TangoColorFactory.ALUMINIUM_4);
    g.fillRect(x - 1,y - 1,3,3);
    g.drawString(Integer.toString(customer.getDemand()),x + 3,y - (TEXT_SIZE / 2) - TEXT_SPACING_SIZE);
    if (customer instanceof VrpTimeWindowedCustomer) {
      VrpTimeWindowedCustomer timeWindowedCustomer=(VrpTimeWindowedCustomer)customer;
      g.drawString(timeWindowedCustomer.getTimeWindowLabel(),x + 3,y + (TEXT_SIZE / 2));
      if (timeWindowedCustomer.getArrivalTime() != null) {
        if (!timeWindowedCustomer.isDepartureTimeBeforeDueTime()) {
          g.setColor(TangoColorFactory.SCARLET_2);
        }
 else         if (!timeWindowedCustomer.isArrivalTimeAfterReadyTime()) {
          g.setColor(TangoColorFactory.ORANGE_2);
        }
        g.drawString(Integer.toString(timeWindowedCustomer.getArrivalTime()),x + 3,y + (TEXT_SIZE / 2) + TEXT_SPACING_SIZE+ TEXT_SIZE);
      }
    }
  }
  g.setColor(TangoColorFactory.ALUMINIUM_3);
  for (  VrpDepot depot : schedule.getDepotList()) {
    int x=translator.translateLongitudeToX(depot.getLocation().getLongitude());
    int y=translator.translateLatitudeToY(depot.getLocation().getLatitude());
    g.fillRect(x - 2,y - 2,5,5);
    g.drawImage(depotImageIcon.getImage(),x - depotImageIcon.getIconWidth() / 2,y - 2 - depotImageIcon.getIconHeight(),imageObserver);
    if (depot instanceof VrpTimeWindowedDepot) {
      VrpTimeWindowedDepot timeWindowedDepot=(VrpTimeWindowedDepot)depot;
      g.drawString(timeWindowedDepot.getTimeWindowLabel(),x + 3,y - 3 + TEXT_SIZE + TEXT_SPACING_SIZE);
    }
  }
  int colorIndex=0;
  for (  VrpVehicle vehicle : schedule.getVehicleList()) {
    g.setColor(TangoColorFactory.SEQUENCE_2[colorIndex]);
    VrpCustomer vehicleInfoCustomer=null;
    int longestNonDepotDistance=-1;
    int load=0;
    for (    VrpCustomer customer : schedule.getCustomerList()) {
      if (customer.getPreviousStandstill() != null && customer.getVehicle() == vehicle) {
        load+=customer.getDemand();
        VrpLocation previousLocation=customer.getPreviousStandstill().getLocation();
        int previousX=translator.translateLongitudeToX(previousLocation.getLongitude());
        int previousY=translator.translateLatitudeToY(previousLocation.getLatitude());
        VrpLocation location=customer.getLocation();
        int x=translator.translateLongitudeToX(location.getLongitude());
        int y=translator.translateLatitudeToY(location.getLatitude());
        g.drawLine(previousX,previousY,x,y);
        int distance=customer.getDistanceToPreviousStandstill();
        if (customer.getPreviousStandstill() instanceof VrpCustomer) {
          if (longestNonDepotDistance < distance) {
            longestNonDepotDistance=distance;
            vehicleInfoCustomer=customer;
          }
        }
 else         if (vehicleInfoCustomer == null) {
          vehicleInfoCustomer=customer;
        }
        boolean needsBackToVehicleLineDraw=true;
        for (        VrpCustomer trailingCustomer : schedule.getCustomerList()) {
          if (trailingCustomer.getPreviousStandstill() == customer) {
            needsBackToVehicleLineDraw=false;
            break;
          }
        }
        if (needsBackToVehicleLineDraw) {
          VrpLocation vehicleLocation=vehicle.getLocation();
          int vehicleX=translator.translateLongitudeToX(vehicleLocation.getLongitude());
          int vehicleY=translator.translateLatitudeToY(vehicleLocation.getLatitude());
          g.drawLine(x,y,vehicleX,vehicleY);
        }
      }
    }
    if (vehicleInfoCustomer != null) {
      if (load > vehicle.getCapacity()) {
        g.setColor(TangoColorFactory.SCARLET_2);
      }
      VrpLocation previousLocation=vehicleInfoCustomer.getPreviousStandstill().getLocation();
      VrpLocation location=vehicleInfoCustomer.getLocation();
      double longitude=(previousLocation.getLongitude() + location.getLongitude()) / 2.0;
      int x=translator.translateLongitudeToX(longitude);
      double latitude=(previousLocation.getLatitude() + location.getLatitude()) / 2.0;
      int y=translator.translateLatitudeToY(latitude);
      boolean ascending=(previousLocation.getLongitude() < location.getLongitude()) ^ (previousLocation.getLatitude() < location.getLatitude());
      ImageIcon vehicleImageIcon=vehicleImageIcons[colorIndex];
      int vehicleInfoHeight=vehicleImageIcon.getIconHeight() + 2 + TEXT_SIZE;
      g.drawImage(vehicleImageIcon.getImage(),x + 1,(ascending ? y - vehicleInfoHeight - 1 : y + 1),imageObserver);
      g.drawString(load + " / " + vehicle.getCapacity(),x + 1,(ascending ? y - 1 : y + vehicleInfoHeight + 1));
    }
    colorIndex=(colorIndex + 1) % TangoColorFactory.SEQUENCE_2.length;
  }
  g.setColor(TangoColorFactory.ALUMINIUM_3);
  g.fillRect(5,(int)height - 12 - TEXT_SIZE- (TEXT_SIZE / 2),5,5);
  g.drawString((schedule instanceof VrpTimeWindowedSchedule) ? "Depot: time window" : "Depot",15,(int)height - 10 - TEXT_SIZE);
  g.setColor(TangoColorFactory.ALUMINIUM_4);
  g.fillRect(6,(int)height - 6 - (TEXT_SIZE / 2),3,3);
  g.drawString((schedule instanceof VrpTimeWindowedSchedule) ? "Customer: demand, time window and arrival time" : "Customer: demand",15,(int)height - 5);
  g.setColor(TangoColorFactory.SCARLET_2);
  HardSoftScore score=schedule.getScore();
  if (score != null) {
    String totalDistanceString;
    if (!score.isFeasible()) {
      totalDistanceString="Not feasible";
    }
 else {
      totalDistanceString=numberFormat.format(-score.getSoftScore()) + " fuel";
    }
    g.setFont(g.getFont().deriveFont(Font.BOLD,(float)TEXT_SIZE * 2));
    g.drawString(totalDistanceString,(int)width - g.getFontMetrics().stringWidth(totalDistanceString) - 10,(int)height - 10);
  }
}
